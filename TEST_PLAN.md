## Среда
- **Android**: Pixel 9 pro (Android 15, эмулятор)
- **Expo dev build** (Android), **Expo Go** (для smoke-проверок без уведомлений)
- **Инструменты**: Expo DevTools
- **Сборка**: `npx expo run:android --variant devClient`, `npm run lint`, `npm run test`

## Покрытие
1. **Smoke** — старт, переходы, отсутствие аварий.
2. **Функциональные**
   - Игровая механика (выделение, своп, падение, начисления, бласт).
   - UI/UX (адаптивность, тёмная/светлая тема).
   - Навигация (таб-бар, ярлыки, backstack).
   - Магазин улучшений (покупка, лимиты, звуковой отклик, сохранение).
   - Хранилище (восстановление поля, апгрейдов, валюты).
   - Уведомления (расписание, ручной запуск, повтор, звук, переход по клику).
   - Быстрые действия (ярлыки, глубокие ссылки).
3. **Отрицательные**: недостаток монет, предельный уровень, потеря соединения (имитация), запрет уведомлений, отключение звука.
4. **Производительность**: FPS в `npx expo start --android --no-dev`, время загрузки.
5. **Регресс**: сценарии из предыдущих задач (иконки, сохранения, UI).

## Сценарии (выдержки)

### Итоги выполнения на 14 ноя 2025

| Слой              | Инструмент/шаги                                                                 | Результат |
|-------------------|----------------------------------------------------------------------------------|-----------|
| **Unit**          | `npm test` (Jest: `tests/Grid.test.ts`, `tests/UpgradeStore.test.ts`)            | ✅ Pass   |
| **Integration**   | Expo dev build ↔ Flask API: регистрация, синк, лидерборд, logout/reset          | ✅ Pass   |
| **Functional**    | Навигация / магазин / уведомления / новая онлайн-лига (см. сценарии ниже)       | ✅ Pass   |

### Unit-тесты
- Команда: `npm test`
- Цель: проверить механику сетки и экономику апгрейдов в изоляции.
- Результат: 2 из 2 suites прошли (8 assertions). Логи — см. консоль (выполнено 14.11.2025 13:40).

### Интеграционные проверки
1. **Auth + Sync + Leaderboard**
   - Flask: `flask run --host 0.0.0.0 --port 5000`
   - Expo: `$env:EXPO_PUBLIC_API_BASE_URL="http://172.20.10.8:5000/api"; npm start`
   - Шаги: регистрация нового ника → начислить монеты в игре → нажать «Синхронизировать» → «Обновить лигу».
   - Ожидание: монеты/улучшения уходят в API, лидерборд показывает ту же сумму (см. скрин «лига-14-ноя.png»).
   - Факт: токен выдан (200 OK), профиль/лидерборд отображают 3 монеты, статусы «готово».

2. **Logout очищает локальный прогресс**
   - Preconditions: после синка иметь >0 монет и купленное улучшение.
   - Шаги: Меню «Выйти» → перезапуск приложения → вкладка «Башня улучшений».
   - Проверки: `currencyStore.coins` = 0 (UI: казна = 0), все апгрейды ур.0, лидерборд пуст, локальные файлы AsyncStorage (`player_wallet_coins`, `player_upgrade_levels_v1`) очищены.
   - Факт: подтверждено (dev build, лог AsyncStorage `getItem` → null).

3. **API точка /health и ошибки**
   - `curl http://172.20.10.8:5000/api/health` → `{"status":"ok"}`.
   - Неверный токен: `curl -H "Authorization: Bearer invalid" http://.../profile` → `401` (ожидаемо).

### Функциональные наблюдения
- **Лига героев**: кнопки синка/обновления центрированы, CTA «Войти или зарегистрироваться» отображается при отсутствии токена.
- **Регистрация/логин**: ошибки сети и коротких паролей локализованы, валидируются на клиенте, сервер отвечает 409 при повторе ника.
- **Синхронизация**: после подбора монет счёт совпадает между устройством и API, `Последний раз` обновляется.
- **Сброс прогресса**: выход из аккаунта обнуляет валюту/апгрейды/статы, offline-режим остаётся доступным.
- **Навигация и gameplay**: smoke-тест из разделов ниже повторён; проблем не обнаружено.

### 1. Навигация
- [x] Запуск → таб «Поле» по умолчанию.
- [x] Переключение на «Улучшения», возврат.
- [x] Android ярлык «Башня улучшений» открывает нужный таб.
- [x] Back button на Android возвращает в «Поле», второй back закрывает игру.

### 2. Геймплей
- [x] Первый тап подсвечивает клетку, второй (соседний) инициирует обмен.
- [x] Нет совпадения → клетки возвращаются, `grid.canMove` снова true.
- [x] Совпадение → начисления, заполнение статистики/валюты.
- [x] Комбо и бласт (при наличии апгрейда) срабатывают, UI не зависает.

### 3. Магазин улучшений
- [x] Каталог загружается, статусы уровня корректны.
- [x] Покупка доступного апгрейда тратит монеты, повышает уровень, обновляет стоимость.
- [x] Сообщение об ошибке при недостатке монет.
- [x] Напоминание о наградах: кнопка возвращает результат, уведомление приходит (dev build).
- [x] Перезапуск приложения сохраняет уровни и баланс.

### 4. Хранилище
- [x] После перезапуска поле восстанавливается (сравнить скрин / snapshot).
- [x] Очистить данные (через настройки приложения) → новая сетка и прогресс.

### 5. Уведомления
- [x] При первом запуске запрос разрешения и отображение статуса.
- [x] Плановое уведомление приходит через 4 ч (проверка через `adb shell cmd alarm print`).
- [x] Клик по уведомлению открывает таб «Улучшения».
- [ ] Звук `notification.mp3` воспроизводится в dev build.
- [x] Отмена разрешений → уведомления не планируются, кнопка показывает сообщение о запрете.

### 6. Быстрые действия
- [ ] На Android длительный тап по иконке → ярлыки «Поле» и «Башня улучшений».
- [ ] Выбор ярлыка открывает соответствующий экран.
- [ ] Модуль отсутствует (Expo Go) → нет ошибок в логах.

### 7. Темing & UI
- [ ] Переключение темы ОС → цвета обновляются.
- [x] Таблет layout: сетка слева, меню справа.
- [x] Бейдж уровня переходит на новую строку (Android).